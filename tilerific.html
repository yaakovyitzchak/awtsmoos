
<div id=BH>B"H</div>
<style>
#BH{
    text-shadow:3px 2px 2px white;
    z-index:76869869876895674;
}
    .d{
        position: absolute;
        left:0;top:0;wsidth:100%;
        heigsht:100%;
    }
    body{
        font-family: helvetica;
    }
    .face {
        position:absolute;
        left:50%;
        top:50%;
        transform:translate(-50%,-50%);
        border:1px solid black;
        width:64;height:64;
    }
    
    .eye{
        position:relative;
        left:50%;
        transform:translate(-100%,50%);
        border-radius:50%;
        border: 0.5px solid black;
        background: white;
        display:inline-block;
        width:16px;height:16px;
    }
</style>
<meta charset="UTF-8">
    <title>AWTSMOOS</title>
<script src="three.min.js"></script>
<script>
//makeFace()
    function makeFace() {
        var a = document.createElement("div")
        document.body.appendChild(a)
        a.className="face"
        
        var i1 = document.createElement("div")
        i1.className="eye"
        a.appendChild(i1)
        
        
        var i2 = document.createElement("div")
        i2.className="eye"
        a.appendChild(i2)
    }
    BH.onclick=()=>{
        
    }
    var curThings = []
    var curLiveMap;
    var keysD = []
    var curMapNum = 0
    
    var maps = [
        [
           /* [
                "",
                "",
                "",
                "",
                "",
                "",
                "",
                
                
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                
            ],*/
            [
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                "gggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggg",
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
            ],
            [
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttt   r        b            r                                     ttttttttt",
                "tttttttt   r p t       t             t                                 ttttttttt",
                "tttttttt       t                                                   t   ttttttttt",
                "tttttttt  b    t    b                t                                 ttttttttt",
                "tttttttt                                                               ttttttttt",
                "ttttttttt ttt    t     rrrrrrrrrrr                                     ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt   t                                                           ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt   r   r                                                       ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt        t                                                      ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt    t                                                          ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt   t                                                           ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt             r                                                 ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttt                                                               ttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt",
                "tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt"
            ],
            [
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '       t                                                                        ',
                '        t                                                                       ',
                '         t                                                                      ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                
            ],
            
            [
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                
            ],
            
            [
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                '                                                                                ',
                
            ]
            /*
            [
                "",
                "",
                "",
                "","",
                "",
                "",
                "",
                
                "        t           t"
            ]*/
        ]
    ]
    
    var th = {
        t: tree,
        r: rock,
        p: player,
        b: booster,
        g: ground
    }
    
    var ts = 64
    function player(opts) {
        thing.call(this, ...arguments)
        this.type = "player"
        this.color = "blue"
        this.addWall("solid")
        var mr = false
        var ml = false
        var mt = false
        var md = false
        var mu = false
        var isFalling=false
        var sp
        var rocks = []
        this.movingRocks=false
        pl=this
        var t = this
        this.rocks=rocks
        this.speed=2
        //this.depth *= 0.2
        var moving = false
        var mx = 0;
        var my = 0;
        var mz = 0;
        this.nft=()=>t.needsToFall
        var mv = false
        function movement() {
            mx = my = mz = 0;  
            if(t.needsToFall) {
                
                mv = t.moveSlot(0,0,-1)
                return;
            }
            
            if(mr) {
                mx = 1;
                mr = false
            }
            
            
            if(ml) {
                mx = -1;
                ml = false
            }
            
            
            if(mt) {
                my = -1
                mt = false
            }
            
            
            if(md) {
                my = 1;
                md = false
            }
            
            if(mu) {
                mz = 1;
                mu=false
            }
            if(mx != 0 || my != 0 || mz != 0)
            t.moveSlot(mx,my,mz)
            
        }
        
        function gatherMoveInfo() {
            
            
            mr = ml = md = mt = mu =
            isFalling = false
            
            
            if(keysD[39]) {
                mr = true
            }
            
            if(keysD[37]) {
                ml = true   
            }
            
            if(keysD[40]) {
                md = true
            }
            
            if(keysD[38]) {
                mt = true
            }
            
            if(keysD[32]) {
                mu = true
            }
            
            hasMove = mr && ml && md && mt
            
        }
        
        function groundUnder() {
            if(t.isMoving) return true;
            var s = t.getSlot()
            if(s.tileZ <= 0) return true
            var ls = getLiveSlot(
                s.tileX,
                s.tileY,
                s.tileZ - 1
            )
            
            if(!ls) return false;
            if(!ls.thing) return false;
            if(ls.tileZ < s.tileZ)
            if(ls.thing.wallType != "solid")
                return false;
                
            return true;
            
        }
        
        var hasMove = false
        var isGroundUnder = false
        this.needsToFall = false;
        var d = 4
        t.distX = d
        t.distY = d
        t.distZ = d
        t.dir = 0
        t.hissHavoos = (() => {
            
            t.needsToFall = false;
            
            gatherMoveInfo()
            
            isGroundUnder = groundUnder()
            if(!isGroundUnder) {
                t.needsToFall = true
                
            }
            
            
            if(rocks)
            rocks.forEach(r=>{
                if(r.isMoving) {
                    r.speed=t.speed
                    r.doMove()
                } else {
                    rocks.splice(rocks.indexOf(r),1)
                }
            })
            
            if(!t.isMoving) {
                movement()
            }
            
            moving = t.doMove()
            
            
            if(!moving) {
                if(hasMove) {
                    movement()
                    moving = t.doMove()
                }
            }
            
            
            
            if(!window.kkk) {
            wrld.camera.position.x = this.
                atz.pashut.position.x + (Math.sin(
                (180 + t.dir) * Math.PI/180 
            ))*t.distX
            wrld.camera.position.z = this.
                atz.pashut.position.z + (Math.cos(
                (180 + t.dir) * Math.PI/180   
            )
            
            ) * t.distY
            
            wrld.camera.position.y= this.atz.pashut.position.y
            + t.distZ;
            wrld.camera.lookAt(this.atz.pashut.position)
            
            
          //  wrld.camera.rotation.Y += Math.PI
            ///    window.kkk=true
            }
            
            
        })
    }
    function tree(opts) {
        
        this.static = true
        thing.call(this, ...arguments)
        this.type = "tree"
        this.color = "green"
        this.wallType = "solid"
        this.shape="cylinder"
        this.tilesZ=2
    }
    
    
    function ground(opts) {
        
        this.static = true
        thing.call(this, ...arguments)
        this.type = "ground"
        this.color = "brown"
        this.wallType = "solid"
    }
    
    
    function rock(opts) {
        thing.call(this, ...arguments)
        this.type = "rock"
        this.color = "gray"
        this.wallType = "solid"
        this.addWall("solid")
        this.action = (os, nsx, nsy, ths) => {
            
            if(os.thing)
            if(os.thing.type == "player") {
                if(!os.thing.movingRocks) {
                    keyD = []
                    os.thing.movingRocks=true
                }
                this.moveSlot(nsx,nsy)
                
                os.thing.rocks.push(this)
            }
        }
    } 
        
    
    function booster(opts) {
        thing.call(this, ...arguments)
        this.type = "booster"
        this.color = "yellow"
        this.wallType = "none"
        this.addWall("solid")
        this.shape="sphere"
        var t = this
        this.action = (os, nsx, nsy, ths) => {
            
            if(os.thing)
            if(os.thing.type == "player") {
                if(!os.thing.boosting) {
                    os.thing.boosting=true
                    var h=os.thing
                    var oys = os.thing.speed
                    h.speed*=2
                    t.seelayk()
                    setTimeout(function() {
                        h.speed=oys
                        h.boosting=false
                    }, 5000);
                }
                
            }
        }
        
    }
    function thing(opts) {
        var x = opts.x || 0
        var y = opts.y || 0
        var z = opts.z || 0
        
        x = x * ts
        y = y * ts
        z = z * ts
        
        var rotation = {x:0,y:0,z:0}
        var width = ts
        var height = ts
        var depth = ts
        var color = opts.color || "black"
        
        var tilesX = opts.tilesX || 1
        var tilesY = opts.tilesY || 1
        var tilesZ = opts.tilesZ || 1
        
        var walls = opts.walls = []
        var self = this
        var t = self
        
        var speed = 4;
        
        var curSpeed = t.speed;
        var oneOverRoot2 = 1 / Math.sqrt(2)
        var as = speed * oneOverRoot2;
        var round = 2;
        var tx=0;
        var ty = 0;
        var tz = 0;
        this.nextSlot=null
        
        tx = (t.x);
            ty = (t.y);
            tz = (t.z);
            
        function doMove() {
            
            if(!t.isMoving) return true;
            
            curSpeed = t.speed
            if(t.z < t.isMoving.z) {
                t.z += curSpeed
            } else
            if(t.z > t.isMoving.z) {
                t.z -= curSpeed
            }
            
            if(t.x < t.isMoving.x) {
                t.x += curSpeed
            } else
            if(t.x > t.isMoving.x) {
                t.x -= curSpeed
            } 
            
            if(t.y > t.isMoving.y) {
                t.y -= curSpeed
            } else
            if(t.y < t.isMoving.y) {
                t.y += curSpeed
            }
            
            if(
                t.y == t.isMoving.y &&
                t.x == t.isMoving.x &&
                t.z == t.isMoving.z
            ) {
                
                t.isMoving = null
                
                /*if(curCovered.length > 0) {
                    var gls;
                    console.log(curCovered,99)
                    curCovered.forEach(cc=> {
                        if(!cc)return;
                        gls = getLiveSlot(cc.x,cc.y,cc.z)
                        if(!gls) return console.log(888);
                        if(!gls.thing) {
                            gls.thing = cc.thing;
                        }
                    })
                    curCovered=[]
                }*/
                return null
            }
            
            
            
            
            
            
            
            
        }
        t.curSlot=null
        function moveSlot(nsx=0, nsy=0, nsz = 0) {
            if(nsx && nsy) nsy = 0;
            var sl = getSlot()
            var cls = getLiveSlot(
                sl.tileX, 
                sl.tileY,
                sl.tileZ
            )
            var newSlx = sl.tileX + nsx
            var newSly = sl.tileY + nsy
            var newSlz = sl.tileZ + nsz
            var nls = getLiveSlot(
                newSlx, 
                newSly,
                newSlz
            )
            var isj = (nsx&&nsz || nsy&&nsz)
            if(nls) {
                
                var canMove = true
                var jm = false;
                var walld = false;
                var isThing = false;
                var aksh = false;
                if(nls.thing && !nls.thing.pl) {
                    isThing = true;
                    if(
                        walls.includes(
                            nls.thing.wallType
                        )
                    ) {
                        walld = true;
                        if(!isj)
                        canMove = false
                        else jm=true
                    }
                    if(
                        typeof(
                            nls.thing.action
                        ) == "function"
                    ) {
                        aksh = true
                        
                    }
                }
                if(aksh) {
                    nls.thing.action(cls, 
                        nsx, 
                        nsy, 
                        nls,
                        t
                    )
                }
                if(canMove) {
                    if(!jm){
                    if(cls) {
                        /*if(isThing  && !walld && 
                        nls.thing != t) {
                            curCovered.push({th:nls.thing, nls})
                            console.log(curCovered)
                        }*/
                        
                        cls.thing = null
                    }
                        nls.thing = self
                    }
                    var npx = nls.tileX * ts * self.tilesX
                    var npy = nls.tileY * ts * self.tilesY
                    var npz = nls.tileZ * ts * self.tilesZ
                    
                    if(jm) {
                        npx =
                        sl.tileX * ts * self.tilesX
                        
                        npy = sl.tileY * ts * self.tilesY
                    }
                    this.isMoving = {
                        x: npx, y: npy, z:npz
                    }
                    return true
                
                } else return false
            } else return false
        }
        
        function getSlot() {
            return ({
                tileX: Math.floor(self.x / (ts *self.tilesX)),
                tileY: Math.floor(self.y / (ts *self.tilesY)),
                
                tileZ: Math.floor(self.z / (ts *self.tilesZ))
            })
        }
        
        
        function getSlots() {
            var sl = [];
            var z=0;
            var y=0;
            var x=0;
            
            var tx= tilesX;
            var ty = tilesY;
            var tz = tilesZ;
            
            var ttx = t.x;
            var tty = t.y;
            var ttz = t.z;
            
            var flx = Math.floor(ttx / (ts))
            var fly = Math.floor(tty / (ts))
            var flz = Math.floor(ttz / (ts))
            for(z = 0; z < tz; z++) {
                for(y = 0; y < ty; y++) {
                    for(x = 0; x < tx; x++) {
                        sl.push({
                            x: flx+x,
                            y: fly+y,
                            z: flz+z
                        })
                    }
                }
            }
            return sl;
        }
        
        
        
        function addWall(nm) {
            if(typeof(nm) == "string") {
                if(!walls.includes[nm])
                    return walls.push(nm)
                else return false
            } else return false
        }
        
        function seelayk() {
            var sl = getSlot()
            var cls = getLiveSlot(sl.tileX, sl.tileY, 
            sl.tileZ)
            
            cls.thing = null
            
            var cy = curThings.indexOf(this)
            if(cy>-1) {
                curThings.splice(cy, 1)
            }
            
            var si = wrld.scene.children
                    .indexOf(t.atz.pashut)
            if(si < 0) return;
            wrld.scene.remove(wrld.scene.children[si])
            
        }
        
        var sh = opts.shape
        
        var atz = new ATZMUS.Nawees({
            shape: sh,
            buff: !t.static
        })
        
        this.start = () => {
            wrld.hoyseef(atz)
        }
        this.atz=atz
        
        this.walls = walls
        var off=[0,0,0]
        
        
        Object.defineProperties(this, {
            doMove: {
                get: () => doMove  
            },
            seelayk: {
                get: () => seelayk
            },
            getWalls: {
                get: () => walls  
            },
            addWall: {
                get: () => addWall  
            },
            moveSlot: {
                get: () => moveSlot  
            },
            
            getSlots: {
                get: () => getSlots
            },
            getSlot: {
                get: () => getSlot  
            },
            color: {
                get: () => color,
                set: v  => {
                    color = v
                    
                    
                    atz.color  = v
                }
            },
            
            shape: {
                get: () => atz.shape,
                set: v  => {
                    
                    atz.shape  = v
                }
            },
            speed: {
                get: () => speed,
                set: v  => {
                    speed=v
                }
            },
            x: {
                get: () => x,
                set: v  => {
                    x = v
                    self.atz.
                    pashut.position.x = -v/ts + off[0]
                }
            },
            
            y: {
                get: () => y,
                set: v  => {
                    y = v
                    self.atz.
                    pashut.position.z = -v/ts + off[1]
                }
            },
            
            z: {
                get: () => z,
                set: v  => {
                    z = v
                    self.atz.
                    pashut.position.y = v/ts + off[2]
                }
            },
            width: {
                get: () => width,
                set: v  => {
                    width = v
                    atz.pashut.scale.x=v/ts
                    off[0] = atz.pashut.scale.x/2;
                    t.x=t.x;
                }
            },
            height: {
                get: () => height,
                set: v  => {
                    height = v
                    atz.pashut.scale.y = v/ts
                    off[2] = atz.pashut.scale.y/2;
                    t.z=t.z;
                }
            },
            
            depth: {
                get: () => depth,
                set: v  => {
                    depth = v
                    atz.pashut.scale.z=v/ts
                    off[1] = atz.pashut.scale.y/2;
                    t.z=t.z;
                }
            },
            
            tilesX: {
                get: () => tilesX,
                set: v  => {
                    tilesX = v
                    self.width = ts * tilesX
                }
            },
            
            tilesY: {
                get: () => tilesY,
                set: v  => {
                    v = Math.floor(v);
                    tilesY = v
                    self.depth = ts * tilesY
                    
                }
            },
            
            tilesZ: {
                get: () => tilesZ,
                set: v  => {
                    var slts = t.getSlots()
                    setLiveSlots(slts,null)
                    
                    tilesZ = v
                    self.height = ts * tilesZ
                    
                    slts = t.getSlots()
                    setLiveSlots(slts,t);
                }
            }
        })
        
        //
        this.color = color
        this.tilesX = tilesX
        this.tilesY = tilesY
        this.tilesZ= tilesZ
        this.x=x
        this.y=y
        this.z=z
        /*
        atz.position = {
            x: self.x, y:self.y
        }
        atz.scale = {
            x: ts * self.tilesX,
            y: ts * self.tilesY
        }*/      
        
        
    }
    
    var curCovered = []
    function liveMap(mapData) {
        var slots = []
        
        mapData.forEach((z,m)=> {
            var zin = []
            slots.push(zin)
            z.forEach((y, i) => {
                var cr=[]
                zin.push(cr)
                
                y.split("")
                .forEach((x, k) => {
                    cr.push({
                        tileX: k,
                        tileY: i,
                        tileZ: m,
                        type: x
                    })
                })
            })
        })
        
        this.slots = slots
    }
    
    function setLiveSlots(ii, th) {
        var lv;
        ii
        .forEach(
            p=>{
            lv = getLiveSlot(p.x,p.y,p.z)
            if(lv)
                lv.thing=th
        })
    }
    function getLiveSlot(x,y,z=0) {
        if(typeof(x) == "object") {
            if(
                typeof(x.tileX)=="number" &&
                typeof(x.tileY)=="number" &&
                typeof(x.tileZ)=="number"
            ) {
                var o = x;
                x = o.tileX;
                y = o.tileY;
                z= o.tileZ;
            }
        }
        if(x < 0 || y < 0 || z < 0)
            return null;
        var tsz = curLiveMap.slots[z]
        if(!tsz) return null
        
        var tst = tsz[y]
        if(tst)
        return tst[x] || null
        else return null
    }
    
    function getTile(x, y, tsX, tsY, map) {
        var xv = Math.floor(x / tsX)
        var yv = Math.floor(y / tsY)
        
    }
    
    
    function makeMap(mapNum) {
        var map = maps[mapNum]
        if(!map) return alert ("LOL NO map " + mapNum + "?!")
        
        curLiveMap = new liveMap(map)
        curThings = []
        map.forEach((z,m)=> {
            
            z.forEach((y,i)=>{
                y.split("")
                .forEach((x,k)=>{
                    var en = th[x]
                    if(!en) return
                    
                    var thing = new en({
                        x: k, y: i, z:m
                    })
                    curThings.push(thing)
                    
                    var cursl = getLiveSlot(k, i, m)
                    
                    if(!cursl) return;
                    
                    cursl.thing = 
                    thing
                    
                })
            })
        })
        
        //combine geometries of static types
        //start by dividing static types into arrays
        var staticTypes = {}
        curThings.forEach(c=> {
            if(c.static) {
                if(!staticTypes[c.type])
                    staticTypes[c.type] = {
                        base:[],
                        geometry:new THREE.
                            Geometry(),
                        color: c.color
                    }
                
                staticTypes[c.type].base.push(c)
            }
        })
        
        
        window.stat = staticTypes
        Object.keys(staticTypes)
        .forEach(s => {
            staticTypes[s].base.forEach(b => {
                staticTypes[s].geometry.mergeMesh(
                    b.atz.pashut    
                )
            })
            
            staticTypes[s].geometry.mergeVertices()
            
            var mat = ATZMUS.Mat({
                    color: staticTypes[s].color
                })
            var geom = staticTypes[s].geometry
            staticTypes[s].merged = new THREE.Mesh(
                geom,
                mat
            )
            
            wrld.scene.add(staticTypes[s].merged)
        })
        
        
        
        curThings.forEach(c=> {
            if(!c.static) c.start()
        })
    }
    
    
    function keyListeners() {
        addEventListener("keydown", e=> {
            keysD[e.keyCode] = true
        })
        
        
        addEventListener("keyup", e => {
            if(keysD[e.keyCode])
                delete keysD[e.keyCode]
        })
    }
    
    function setupCamera() {
        wrld.camera.position.z = -7
        
        wrld.camera.position.x = 800 
        wrld.camera.position.y = 800
        
        /*
        wrld.camera.rotation.y = 
         wrld.camera.rotation.z = Math.PI*/
    }
    
    function setupWorld() {
        onresize=rs
        var rnd = new THREE.WebGLRenderer({
            alpha:1
        })
        wrld.renderer=rnd
        var cm = new THREE.PerspectiveCamera(
            75,
            0,
            0.1,
            1000
        )
        wrld.camera=cm
        
        var sc = new THREE.Scene()
        wrld.scene=sc
        
        
        document.body.appendChild(rnd.domElement)
        rnd.domElement.className="d"
        
        rs()
        function rs() {
            rnd.setSize(
                innerWidth,innerHeight
            )
            
            cm.aspect = (
                rnd.domElement.clientWidth/
                rnd.domElement.clientHeight
            )
            
            cm.updateProjectionMatrix()
        }
        wrld.hoyseef=(awts)=> {
           sc.add(awts.pashut)
        }
        wrld.render = () => {
            rnd.render(sc, cm)
        }
        
        function lights() {
            
            var hl = new THREE.HemisphereLight(
                0x999999,
                0x222222
                
            )
            hl.position.set(0.2,1,0)
            wrld.scene.add(hl)
            var hl = new THREE.DirectionalLight(
                0xffffff
            )
            hl.position.set(0.2,1,0)
            wrld.scene.add(hl)
        }
        
        lights()
        setInterval(
            ()=>
            wrld
            .renderer
            .render(wrld.scene,wrld.camera),16
        )
        var mats = []
        var geoms = []
        
        function newMat() {
            
        }
        
        
        var lm=new THREE.MeshBasicMaterial({
            color:"blue"
        })
        var geoms = {
            box: {
                reg: "BoxGeometry",
                buf: "BoxBufferGeometry",
                deef: [1,1,1]
            },
            sphere: {
                reg: "SphereGeometry",
                buf: "SphereBufferGeometry",
                deef: [0.5, 7, 7]
            },
            cylinder: {
                reg: "CylinderGeometry",
                buf: "CylinderBufferGeometry",
                deef: [0.5, 0.5, 1,6]
            }
        }
        
        var mawchs={
            mats:[],geoms:[]
        }
        
        
        ATZMUS={
            Mawchsawn: mawchs,
            tsoor: function(opts={}) {
                var can = document.createElement("canvas")  
                var wd = opts.width || ts;
                var ht = opts.height || ts;
                can.wdith = wd;
                can.height = ht;
                
                var ctx = can.getContext("2d");
                var tx = new THREE.CanvasTexture(can);
                this.ctx=ctx;
                this.tx = tx;
            },
            
            Geo:function(opts={}) {
                
                if(!opts.cb)opts.cb=()=>{}
                var cl = opts.shape || "box"
                
                var isBuf = !!opts.isBuff
                var args = opts.args || null;
                
               
                var geo = geoms[cl];
                if(!geo) geo=geoms.box;
                
                if(!args)
                    args=geo.deef;
                    
                var ty = isBuf?geo.buf:geo.reg;
                var realG;
                
                var g = mawchs.geoms.find(x=> (
                    x.type == ty &&
                    objEq(Object.values(x.parameters)
                    .filter(z=>z),args)
                ))
                
                
                if(!g) {
                    var G = new THREE[ty](...args)
                    mawchs.geoms.push(G)
                    return G;
                }
                
                return g
                
            },
            Mat:function(opts={}) {
                
                if(!opts.cb)opts.cb=()=>{}
                var cl = opts.color || "blue"
                
                var tc;
                if(typeof(cl) == "string")
                    tc= new THREE.Color(cl)
                else tc = cl
                var g = mawchs.mats.find(x=>
                    objEq(x.color,tc)
                )
                if(!g) {
                    var lm=new THREE.
                    MeshLambertMaterial
                  //  MeshBasicMaterial
                    ({
                        color:tc
                    })
                    mawchs.mats.push(lm)
                    return lm
                }
                
                return g
                
            },
            Kav:function(opts={}) {
                if(!opts.cb)opts.cb=()=>{}
                Object.defineProperties(this,{
                      
                })
            },
            Nawees:function(opts={}) {
                var isBuff = opts.buff
                
                var scale={}
                var position = {}
                var mat = ATZMUS.Mat({
                    color: opts.color
                })
                var geom = ATZMUS.Geo({
                    isBuff,
                    shape: opts.shape
                })
                this.pashut = new THREE.Mesh(
                    geom,
                    mat
                )
                var t = this
                var shape
                Object.defineProperties(this,{
                    scale: {
                        get:()=>scale
                    },
                    position: {
                        get:()=>position
                    },
                    
                    shape: {
                        get:()=>t.pashut.geometry.type,
                        set:v =>{
                            var w;
                            if(typeof(v) != "object"||!v)
                                w={}
                            if(typeof(v)=="string")
                                w = {
                                    shape:v
                                    
                                }
                            var g = ATZMUS.Geo(w)
                            
                            t.pashut
                            .geometry=g
                        }
                    },
                    color: {
                        get:()=>t.color,
                        set:v =>{
                            var mat = ATZMUS.Mat({
                                color: v
                            })
                            t.pashut
                            .material=mat
                        }
                    }
                })
            }
        }
    }
    function st(wrld) {
        window.wrld={}
        setupWorld()
        keyListeners()
        makeMap(curMapNum)
        setupCamera()
        livethings = curThings.filter(t=>t.hissHavoos)
        setInterval(function() {
            
            livethings.forEach(t=>{
                if(typeof(t.hissHavoos) == "function") {
                    t.hissHavoos(t)
                }
            })
            
            
            
        }, 1000/60)
        
    }
    isDone = true
   st()
    
    
    
    function objEq(ob1,ob2) {
            var eq = true
            var props1 = Object.keys(ob1)
            var props2 = Object.keys(ob2)
            if(props1.length != props2.length)
                return false
                
            props1.forEach(z=> {
                if(ob1[z] !== ob2[z]) 
                    eq = false
            })
            return eq
        }
</script>

